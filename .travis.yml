language: c

git:
  depth: 1

env:
  global:
    - OCAML_VERSION: 4.10.0
    - OPAM_VERSION: 846c64c1b6a7daed87cfd939da359e9a6ab73368
    - DUNIVERSE_VERSION: 414f2a25354bc2fcd95f9b22018fe633f9969a69

jobs:
  include:
    - os: linux
      dist: bionic
      services:
        - docker
      script:
        - docker build --build-arg=OCAML_VERSION=$OCAML_VERSION --build-arg=OPAM_VERSION=$OPAM_VERSION --build-arg=DUNIVERSE_VERSION=$DUNIVERSE_VERSION -f "linux/Dockerfile" "linux/"
    - os: linux
      dist: bionic
      script:
        - $TRAVIS_BUILD_DIR/build.sh -s linux
    - os: osx
      script:
        - $TRAVIS_BUILD_DIR/build.sh -s macos

cache:
  directories:
    - opam-$OPAM_VERSION/bootstrap
