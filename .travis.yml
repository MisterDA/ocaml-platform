language: c

git:
  depth: 1

env:
  global:
    - OCAML_VERSION: 4.10.0
    - OPAM_VERSION: 3def1a6d1ff102aaa608f5e9170783b96f55069d

jobs:
  include:
    - os: linux
      dist: bionic
      services:
        - docker
      script:
        - docker build --build-arg=OCAML_VERSION=$OCAML_VERSION --build-arg=OPAM_VERSION=$OPAM_VERSION -f "linux/Dockerfile" "linux/"
    - os: linux
      dist: bionic
      script:
        - $TRAVIS_BUILD_DIR/build.sh -s linux
    - os: osx
      script:
        - $TRAVIS_BUILD_DIR/build.sh -s macos

cache:
  directories:
    - opam-$OPAM_VERSION/bootstrap
